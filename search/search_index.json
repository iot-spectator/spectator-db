{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"SpectatorDB SpectatorDB is a Python library for managing media files (images and videos) and their metadata. It stores media files in the local file system and tracks metadata in a SQLite database, making it easy to organize, retrieve, and manage your media assets programmatically. Requirements Python 3.13+ Installation Clone the repository and install dependencies: # Clone the repository $ git clone https://github.com/iot-spectator/spectator-db.git $ cd spectator-db $ python -m pip install -r requirements.txt Usage Basic Example from spectatordb.spectatordb import SpectatorDB, MediaType from spectatordb.connector.sqlite_connector import SQLiteConnector from spectatordb.storage.local_storage import LocalStorage import pathlib # Set up storage and database connector storage = LocalStorage(\"./media\") sql_connector = SQLiteConnector(\"./spectator.db\") # Initialize SpectatorDB spectator_db = SpectatorDB(storage, sql_connector) # Insert an image file image_path = pathlib.Path(\"/path/to/image.jpg\") spectator_db.insert(image_path, MediaType.IMAGE) # Insert a video file video_path = pathlib.Path(\"/path/to/video.mp4\") spectator_db.insert(video_path, MediaType.VIDEO)","title":"Home"},{"location":"#spectatordb","text":"SpectatorDB is a Python library for managing media files (images and videos) and their metadata. It stores media files in the local file system and tracks metadata in a SQLite database, making it easy to organize, retrieve, and manage your media assets programmatically.","title":"SpectatorDB"},{"location":"#requirements","text":"Python 3.13+","title":"Requirements"},{"location":"#installation","text":"Clone the repository and install dependencies: # Clone the repository $ git clone https://github.com/iot-spectator/spectator-db.git $ cd spectator-db $ python -m pip install -r requirements.txt","title":"Installation"},{"location":"#usage","text":"","title":"Usage"},{"location":"#basic-example","text":"from spectatordb.spectatordb import SpectatorDB, MediaType from spectatordb.connector.sqlite_connector import SQLiteConnector from spectatordb.storage.local_storage import LocalStorage import pathlib # Set up storage and database connector storage = LocalStorage(\"./media\") sql_connector = SQLiteConnector(\"./spectator.db\") # Initialize SpectatorDB spectator_db = SpectatorDB(storage, sql_connector) # Insert an image file image_path = pathlib.Path(\"/path/to/image.jpg\") spectator_db.insert(image_path, MediaType.IMAGE) # Insert a video file video_path = pathlib.Path(\"/path/to/video.mp4\") spectator_db.insert(video_path, MediaType.VIDEO)","title":"Basic Example"},{"location":"reference/","text":"API Reference connector sqlite_connector SQLiteConnector A class to handle SQLite database connections and operations. Source code in spectatordb/connector/sqlite_connector.py 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 class SQLiteConnector : \"\"\"A class to handle SQLite database connections and operations.\"\"\" def __init__ ( self , db_path : str ): \"\"\"Initialize the SQLite connector with a database path. Parameters ---------- db_path : str The file path to the SQLite database. \"\"\" self . _db_path = db_path self . _connection = sqlite3 . connect ( self . _db_path ) self . _cursor = self . _connection . cursor () def __del__ ( self ): \"\"\"Ensure the database connection is closed when the object is deleted.\"\"\" self . _connection . close () def execute_query ( self , query : str , params : tuple = ()): \"\"\"Execute a SQL query with optional parameters. Parameters ---------- query : str The SQL query to execute. params : tuple, optional Parameters to bind to the query. \"\"\" self . _cursor . execute ( query , params ) self . _connection . commit () __del__ () Ensure the database connection is closed when the object is deleted. Source code in spectatordb/connector/sqlite_connector.py 19 20 21 def __del__ ( self ): \"\"\"Ensure the database connection is closed when the object is deleted.\"\"\" self . _connection . close () __init__ ( db_path ) Initialize the SQLite connector with a database path. Parameters db_path : str The file path to the SQLite database. Source code in spectatordb/connector/sqlite_connector.py 7 8 9 10 11 12 13 14 15 16 17 def __init__ ( self , db_path : str ): \"\"\"Initialize the SQLite connector with a database path. Parameters ---------- db_path : str The file path to the SQLite database. \"\"\" self . _db_path = db_path self . _connection = sqlite3 . connect ( self . _db_path ) self . _cursor = self . _connection . cursor () execute_query ( query , params = ()) Execute a SQL query with optional parameters. Parameters query : str The SQL query to execute. params : tuple, optional Parameters to bind to the query. Source code in spectatordb/connector/sqlite_connector.py 23 24 25 26 27 28 29 30 31 32 33 34 def execute_query ( self , query : str , params : tuple = ()): \"\"\"Execute a SQL query with optional parameters. Parameters ---------- query : str The SQL query to execute. params : tuple, optional Parameters to bind to the query. \"\"\" self . _cursor . execute ( query , params ) self . _connection . commit () spectatordb MediaType Bases: StrEnum Defines the types of media that can be stored in the database. Source code in spectatordb/spectatordb.py 10 11 12 13 14 class MediaType ( enum . StrEnum ): \"\"\"Defines the types of media that can be stored in the database.\"\"\" VIDEO = enum . auto () IMAGE = enum . auto () SpectatorDB Main class for managing media data storage and retrieval. Source code in spectatordb/spectatordb.py 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 class SpectatorDB : \"\"\"Main class for managing media data storage and retrieval.\"\"\" def __init__ ( self , storage : storage . Storage , sql_connector : sqlite_connector . SQLiteConnector ): \"\"\"Initialize the SpectatorDB with a storage backend. Parameters ---------- storage : storage.Storage An instance of a storage backend that implements the Storage interface. sql_connector : sql_connector.SQLiteConnector An instance of the SQLiteConnector for database operations. \"\"\" self . _storage = storage self . _sql_connector = sql_connector self . _METADATA_TABLE = \"metadata\" self . _create_metadata_db () def _create_metadata_db ( self ) -> None : CREATE_STATEMENT = f \"\"\" CREATE TABLE IF NOT EXISTS { self . _METADATA_TABLE } ( name text PRIMARY KEY, path text NOT NULL, size integer NOT NULL, media_type text NOT NULL CHECK(media_type IN ('VIDEO', 'IMAGE')), format text NOT NULL, inserted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP );\"\"\" self . _sql_connector . execute_query ( query = CREATE_STATEMENT ) def insert ( self , file : pathlib . Path , media_type : MediaType ) -> None : \"\"\"Insert a media data. Parameters ---------- file : pathlib.Path The full path of the file to be inserted. media_type : MediaType The type of the data, either VIDEO or IMAGE. \"\"\" INSERT_STATEMENT = f \"\"\" INSERT INTO { self . _METADATA_TABLE } ( name, path, size, media_type, format, inserted_at, ) VALUES (?, ?, ?, ?, ?, ?, ?); \"\"\" self . _storage . save ( file , mode = storage . SaveMode . COPY ) self . _sql_connector . execute_query ( query = INSERT_STATEMENT , params = ( file . name , str ( file ), file . stat () . st_size , media_type . value , file . suffix . lstrip ( \".\" ), datetime . now () . isoformat (), ), ) def delete ( self , name : str ) -> None : \"\"\"Delete a file. Parameters ---------- name : str The name of the file to delete. \"\"\" DELETE_STATEMENT = f \"\"\" DELETE FROM { self . _METADATA_TABLE } WHERE name = ?; \"\"\" self . _sql_connector . execute_query ( query = DELETE_STATEMENT , params = ( name ,)) self . _storage . delete ( name = name ) __init__ ( storage , sql_connector ) Initialize the SpectatorDB with a storage backend. Parameters storage : storage.Storage An instance of a storage backend that implements the Storage interface. sql_connector : sql_connector.SQLiteConnector An instance of the SQLiteConnector for database operations. Source code in spectatordb/spectatordb.py 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 def __init__ ( self , storage : storage . Storage , sql_connector : sqlite_connector . SQLiteConnector ): \"\"\"Initialize the SpectatorDB with a storage backend. Parameters ---------- storage : storage.Storage An instance of a storage backend that implements the Storage interface. sql_connector : sql_connector.SQLiteConnector An instance of the SQLiteConnector for database operations. \"\"\" self . _storage = storage self . _sql_connector = sql_connector self . _METADATA_TABLE = \"metadata\" self . _create_metadata_db () delete ( name ) Delete a file. Parameters name : str The name of the file to delete. Source code in spectatordb/spectatordb.py 83 84 85 86 87 88 89 90 91 92 93 94 95 def delete ( self , name : str ) -> None : \"\"\"Delete a file. Parameters ---------- name : str The name of the file to delete. \"\"\" DELETE_STATEMENT = f \"\"\" DELETE FROM { self . _METADATA_TABLE } WHERE name = ?; \"\"\" self . _sql_connector . execute_query ( query = DELETE_STATEMENT , params = ( name ,)) self . _storage . delete ( name = name ) insert ( file , media_type ) Insert a media data. Parameters file : pathlib.Path The full path of the file to be inserted. media_type : MediaType The type of the data, either VIDEO or IMAGE. Source code in spectatordb/spectatordb.py 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 def insert ( self , file : pathlib . Path , media_type : MediaType ) -> None : \"\"\"Insert a media data. Parameters ---------- file : pathlib.Path The full path of the file to be inserted. media_type : MediaType The type of the data, either VIDEO or IMAGE. \"\"\" INSERT_STATEMENT = f \"\"\" INSERT INTO { self . _METADATA_TABLE } ( name, path, size, media_type, format, inserted_at, ) VALUES (?, ?, ?, ?, ?, ?, ?); \"\"\" self . _storage . save ( file , mode = storage . SaveMode . COPY ) self . _sql_connector . execute_query ( query = INSERT_STATEMENT , params = ( file . name , str ( file ), file . stat () . st_size , media_type . value , file . suffix . lstrip ( \".\" ), datetime . now () . isoformat (), ), ) storage local_storage LocalStorage Bases: Storage Local file system storage backend. Provides methods to save, retrieve, delete, and list files in a local directory. Parameters storage_dir : pathlib.Path The directory where files will be stored. If it does not exist, it will be created. Example storage = LocalStorage(pathlib.Path('/path/to/storage')) storage.save(pathlib.Path('/path/to/file.txt')) storage.retrieve('file.txt', pathlib.Path('/path/to/destination')) storage.delete('file.txt') files = storage.list_all() # List all stored files Source code in spectatordb/storage/local_storage.py 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 class LocalStorage ( storage . Storage ): \"\"\"Local file system storage backend. Provides methods to save, retrieve, delete, and list files in a local directory. Parameters ---------- storage_dir : pathlib.Path The directory where files will be stored. If it does not exist, it will be created. Example ------- >>> storage = LocalStorage(pathlib.Path('/path/to/storage')) >>> storage.save(pathlib.Path('/path/to/file.txt')) >>> storage.retrieve('file.txt', pathlib.Path('/path/to/destination')) >>> storage.delete('file.txt') >>> files = storage.list_all() # List all stored files \"\"\" def __init__ ( self , storage_dir : pathlib . Path ): self . _storage_dir = storage_dir self . _storage_dir . mkdir ( parents = True , exist_ok = True ) @override def save ( self , file : pathlib . Path , mode : Optional [ storage . SaveMode ] = storage . SaveMode . COPY , ) -> None : \"\"\"Save a file to the local storage directory. Parameters ---------- file : pathlib.Path The full path of the file to be saved. mode : SaveMode The mode to save the file, either COPY or MOVE. Raises ------ FileNotFoundError If the source file does not exist. FileExistsError If the file already exists in the storage directory when using COPY mode. \"\"\" if not file . exists (): raise FileNotFoundError ( f \"Source file { file } does not exist.\" ) target_path = self . _storage_dir / file . name if mode == storage . SaveMode . MOVE : shutil . move ( file , target_path ) else : if target_path . exists (): raise FileExistsError ( f \"File { target_path } already exists in storage.\" ) shutil . copy2 ( file , target_path ) @override def retrieve ( self , name : str , dest : pathlib . Path ) -> None : \"\"\"Retrieve a file from the local storage directory to a destination path. Parameters ---------- name : str The name of the file to retrieve. dest : pathlib.Path The destination path where the file will be copied. Raises ------ FileNotFoundError If the file does not exist in the storage directory. \"\"\" target_path = self . _storage_dir / name if not target_path . exists (): raise FileNotFoundError ( f \"Video ' { name } ' not found.\" ) shutil . copy2 ( target_path , dest ) @override def delete ( self , name : str ) -> None : \"\"\"Delete a file from the local storage directory. Parameters ---------- name : str The name of the file to delete. \"\"\" target_path = self . _storage_dir / name if target_path . exists (): target_path . unlink () @override def list_all ( self ) -> list [ pathlib . Path ]: \"\"\"List all files stored in the local storage directory. Returns ------- list[pathlib.Path] A list of pathlib.Path objects representing all files in the storage directory. \"\"\" return list ( self . _storage_dir . iterdir ()) delete ( name ) Delete a file from the local storage directory. Parameters name : str The name of the file to delete. Source code in spectatordb/storage/local_storage.py 88 89 90 91 92 93 94 95 96 97 98 99 @override def delete ( self , name : str ) -> None : \"\"\"Delete a file from the local storage directory. Parameters ---------- name : str The name of the file to delete. \"\"\" target_path = self . _storage_dir / name if target_path . exists (): target_path . unlink () list_all () List all files stored in the local storage directory. Returns list[pathlib.Path] A list of pathlib.Path objects representing all files in the storage directory. Source code in spectatordb/storage/local_storage.py 101 102 103 104 105 106 107 108 109 110 111 @override def list_all ( self ) -> list [ pathlib . Path ]: \"\"\"List all files stored in the local storage directory. Returns ------- list[pathlib.Path] A list of pathlib.Path objects representing all files in the storage directory. \"\"\" return list ( self . _storage_dir . iterdir ()) retrieve ( name , dest ) Retrieve a file from the local storage directory to a destination path. Parameters name : str The name of the file to retrieve. dest : pathlib.Path The destination path where the file will be copied. Raises FileNotFoundError If the file does not exist in the storage directory. Source code in spectatordb/storage/local_storage.py 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 @override def retrieve ( self , name : str , dest : pathlib . Path ) -> None : \"\"\"Retrieve a file from the local storage directory to a destination path. Parameters ---------- name : str The name of the file to retrieve. dest : pathlib.Path The destination path where the file will be copied. Raises ------ FileNotFoundError If the file does not exist in the storage directory. \"\"\" target_path = self . _storage_dir / name if not target_path . exists (): raise FileNotFoundError ( f \"Video ' { name } ' not found.\" ) shutil . copy2 ( target_path , dest ) save ( file , mode = storage . SaveMode . COPY ) Save a file to the local storage directory. Parameters file : pathlib.Path The full path of the file to be saved. mode : SaveMode The mode to save the file, either COPY or MOVE. Raises FileNotFoundError If the source file does not exist. FileExistsError If the file already exists in the storage directory when using COPY mode. Source code in spectatordb/storage/local_storage.py 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 @override def save ( self , file : pathlib . Path , mode : Optional [ storage . SaveMode ] = storage . SaveMode . COPY , ) -> None : \"\"\"Save a file to the local storage directory. Parameters ---------- file : pathlib.Path The full path of the file to be saved. mode : SaveMode The mode to save the file, either COPY or MOVE. Raises ------ FileNotFoundError If the source file does not exist. FileExistsError If the file already exists in the storage directory when using COPY mode. \"\"\" if not file . exists (): raise FileNotFoundError ( f \"Source file { file } does not exist.\" ) target_path = self . _storage_dir / file . name if mode == storage . SaveMode . MOVE : shutil . move ( file , target_path ) else : if target_path . exists (): raise FileExistsError ( f \"File { target_path } already exists in storage.\" ) shutil . copy2 ( file , target_path ) storage SaveMode Bases: StrEnum Defines the modes for saving files in storage. Source code in spectatordb/storage/storage.py 10 11 12 13 14 class SaveMode ( enum . StrEnum ): \"\"\"Defines the modes for saving files in storage.\"\"\" COPY = enum . auto () MOVE = enum . auto () Storage Abstract base class for storage backends. Defines the interface for saving, retrieving, deleting, and listing data objects. Source code in spectatordb/storage/storage.py 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 class Storage : \"\"\"Abstract base class for storage backends. Defines the interface for saving, retrieving, deleting, and listing data objects. \"\"\" @abc . abstractmethod def save ( self , file : pathlib . Path , mode : Optional [ SaveMode ] = SaveMode . COPY ) -> None : \"\"\"Save a file into the storage system. Parameters ---------- file : pathlib.Path The full path of the file to be saved in storage. mode: SaveMode Copy or move the file to the storage system. \"\"\" pass @abc . abstractmethod def retrieve ( self , name : str , dest : pathlib . Path ): \"\"\"Retrieve the file to the given destination. Parameters ---------- name : str The name or identifier of the file to retrieve. dest: pathlib.Path The destination that the file is retrieved to. \"\"\" pass @abc . abstractmethod def delete ( self , name : str ) -> None : \"\"\"Delete a file by its name. Parameters ---------- name : str The name or identifier of the file to delete. \"\"\" pass @abc . abstractmethod def list_all ( self ) -> list [ pathlib . Path ]: \"\"\"Return a list of names or identifiers for all stored files.\"\"\" pass delete ( name ) abstractmethod Delete a file by its name. Parameters name : str The name or identifier of the file to delete. Source code in spectatordb/storage/storage.py 52 53 54 55 56 57 58 59 60 61 @abc . abstractmethod def delete ( self , name : str ) -> None : \"\"\"Delete a file by its name. Parameters ---------- name : str The name or identifier of the file to delete. \"\"\" pass list_all () abstractmethod Return a list of names or identifiers for all stored files. Source code in spectatordb/storage/storage.py 63 64 65 66 @abc . abstractmethod def list_all ( self ) -> list [ pathlib . Path ]: \"\"\"Return a list of names or identifiers for all stored files.\"\"\" pass retrieve ( name , dest ) abstractmethod Retrieve the file to the given destination. Parameters name : str The name or identifier of the file to retrieve. pathlib.Path The destination that the file is retrieved to. Source code in spectatordb/storage/storage.py 38 39 40 41 42 43 44 45 46 47 48 49 50 @abc . abstractmethod def retrieve ( self , name : str , dest : pathlib . Path ): \"\"\"Retrieve the file to the given destination. Parameters ---------- name : str The name or identifier of the file to retrieve. dest: pathlib.Path The destination that the file is retrieved to. \"\"\" pass save ( file , mode = SaveMode . COPY ) abstractmethod Save a file into the storage system. Parameters file : pathlib.Path The full path of the file to be saved in storage. mode: SaveMode Copy or move the file to the storage system. Source code in spectatordb/storage/storage.py 23 24 25 26 27 28 29 30 31 32 33 34 35 36 @abc . abstractmethod def save ( self , file : pathlib . Path , mode : Optional [ SaveMode ] = SaveMode . COPY ) -> None : \"\"\"Save a file into the storage system. Parameters ---------- file : pathlib.Path The full path of the file to be saved in storage. mode: SaveMode Copy or move the file to the storage system. \"\"\" pass","title":"Reference"},{"location":"reference/#api-reference","text":"","title":"API Reference"},{"location":"reference/#spectatordb.connector","text":"","title":"connector"},{"location":"reference/#spectatordb.connector.sqlite_connector","text":"","title":"sqlite_connector"},{"location":"reference/#spectatordb.connector.sqlite_connector.SQLiteConnector","text":"A class to handle SQLite database connections and operations. Source code in spectatordb/connector/sqlite_connector.py 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 class SQLiteConnector : \"\"\"A class to handle SQLite database connections and operations.\"\"\" def __init__ ( self , db_path : str ): \"\"\"Initialize the SQLite connector with a database path. Parameters ---------- db_path : str The file path to the SQLite database. \"\"\" self . _db_path = db_path self . _connection = sqlite3 . connect ( self . _db_path ) self . _cursor = self . _connection . cursor () def __del__ ( self ): \"\"\"Ensure the database connection is closed when the object is deleted.\"\"\" self . _connection . close () def execute_query ( self , query : str , params : tuple = ()): \"\"\"Execute a SQL query with optional parameters. Parameters ---------- query : str The SQL query to execute. params : tuple, optional Parameters to bind to the query. \"\"\" self . _cursor . execute ( query , params ) self . _connection . commit ()","title":"SQLiteConnector"},{"location":"reference/#spectatordb.connector.sqlite_connector.SQLiteConnector.__del__","text":"Ensure the database connection is closed when the object is deleted. Source code in spectatordb/connector/sqlite_connector.py 19 20 21 def __del__ ( self ): \"\"\"Ensure the database connection is closed when the object is deleted.\"\"\" self . _connection . close ()","title":"__del__"},{"location":"reference/#spectatordb.connector.sqlite_connector.SQLiteConnector.__init__","text":"Initialize the SQLite connector with a database path.","title":"__init__"},{"location":"reference/#spectatordb.connector.sqlite_connector.SQLiteConnector.__init__--parameters","text":"db_path : str The file path to the SQLite database. Source code in spectatordb/connector/sqlite_connector.py 7 8 9 10 11 12 13 14 15 16 17 def __init__ ( self , db_path : str ): \"\"\"Initialize the SQLite connector with a database path. Parameters ---------- db_path : str The file path to the SQLite database. \"\"\" self . _db_path = db_path self . _connection = sqlite3 . connect ( self . _db_path ) self . _cursor = self . _connection . cursor ()","title":"Parameters"},{"location":"reference/#spectatordb.connector.sqlite_connector.SQLiteConnector.execute_query","text":"Execute a SQL query with optional parameters.","title":"execute_query"},{"location":"reference/#spectatordb.connector.sqlite_connector.SQLiteConnector.execute_query--parameters","text":"query : str The SQL query to execute. params : tuple, optional Parameters to bind to the query. Source code in spectatordb/connector/sqlite_connector.py 23 24 25 26 27 28 29 30 31 32 33 34 def execute_query ( self , query : str , params : tuple = ()): \"\"\"Execute a SQL query with optional parameters. Parameters ---------- query : str The SQL query to execute. params : tuple, optional Parameters to bind to the query. \"\"\" self . _cursor . execute ( query , params ) self . _connection . commit ()","title":"Parameters"},{"location":"reference/#spectatordb.spectatordb","text":"","title":"spectatordb"},{"location":"reference/#spectatordb.spectatordb.MediaType","text":"Bases: StrEnum Defines the types of media that can be stored in the database. Source code in spectatordb/spectatordb.py 10 11 12 13 14 class MediaType ( enum . StrEnum ): \"\"\"Defines the types of media that can be stored in the database.\"\"\" VIDEO = enum . auto () IMAGE = enum . auto ()","title":"MediaType"},{"location":"reference/#spectatordb.spectatordb.SpectatorDB","text":"Main class for managing media data storage and retrieval. Source code in spectatordb/spectatordb.py 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 class SpectatorDB : \"\"\"Main class for managing media data storage and retrieval.\"\"\" def __init__ ( self , storage : storage . Storage , sql_connector : sqlite_connector . SQLiteConnector ): \"\"\"Initialize the SpectatorDB with a storage backend. Parameters ---------- storage : storage.Storage An instance of a storage backend that implements the Storage interface. sql_connector : sql_connector.SQLiteConnector An instance of the SQLiteConnector for database operations. \"\"\" self . _storage = storage self . _sql_connector = sql_connector self . _METADATA_TABLE = \"metadata\" self . _create_metadata_db () def _create_metadata_db ( self ) -> None : CREATE_STATEMENT = f \"\"\" CREATE TABLE IF NOT EXISTS { self . _METADATA_TABLE } ( name text PRIMARY KEY, path text NOT NULL, size integer NOT NULL, media_type text NOT NULL CHECK(media_type IN ('VIDEO', 'IMAGE')), format text NOT NULL, inserted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP );\"\"\" self . _sql_connector . execute_query ( query = CREATE_STATEMENT ) def insert ( self , file : pathlib . Path , media_type : MediaType ) -> None : \"\"\"Insert a media data. Parameters ---------- file : pathlib.Path The full path of the file to be inserted. media_type : MediaType The type of the data, either VIDEO or IMAGE. \"\"\" INSERT_STATEMENT = f \"\"\" INSERT INTO { self . _METADATA_TABLE } ( name, path, size, media_type, format, inserted_at, ) VALUES (?, ?, ?, ?, ?, ?, ?); \"\"\" self . _storage . save ( file , mode = storage . SaveMode . COPY ) self . _sql_connector . execute_query ( query = INSERT_STATEMENT , params = ( file . name , str ( file ), file . stat () . st_size , media_type . value , file . suffix . lstrip ( \".\" ), datetime . now () . isoformat (), ), ) def delete ( self , name : str ) -> None : \"\"\"Delete a file. Parameters ---------- name : str The name of the file to delete. \"\"\" DELETE_STATEMENT = f \"\"\" DELETE FROM { self . _METADATA_TABLE } WHERE name = ?; \"\"\" self . _sql_connector . execute_query ( query = DELETE_STATEMENT , params = ( name ,)) self . _storage . delete ( name = name )","title":"SpectatorDB"},{"location":"reference/#spectatordb.spectatordb.SpectatorDB.__init__","text":"Initialize the SpectatorDB with a storage backend.","title":"__init__"},{"location":"reference/#spectatordb.spectatordb.SpectatorDB.__init__--parameters","text":"storage : storage.Storage An instance of a storage backend that implements the Storage interface. sql_connector : sql_connector.SQLiteConnector An instance of the SQLiteConnector for database operations. Source code in spectatordb/spectatordb.py 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 def __init__ ( self , storage : storage . Storage , sql_connector : sqlite_connector . SQLiteConnector ): \"\"\"Initialize the SpectatorDB with a storage backend. Parameters ---------- storage : storage.Storage An instance of a storage backend that implements the Storage interface. sql_connector : sql_connector.SQLiteConnector An instance of the SQLiteConnector for database operations. \"\"\" self . _storage = storage self . _sql_connector = sql_connector self . _METADATA_TABLE = \"metadata\" self . _create_metadata_db ()","title":"Parameters"},{"location":"reference/#spectatordb.spectatordb.SpectatorDB.delete","text":"Delete a file.","title":"delete"},{"location":"reference/#spectatordb.spectatordb.SpectatorDB.delete--parameters","text":"name : str The name of the file to delete. Source code in spectatordb/spectatordb.py 83 84 85 86 87 88 89 90 91 92 93 94 95 def delete ( self , name : str ) -> None : \"\"\"Delete a file. Parameters ---------- name : str The name of the file to delete. \"\"\" DELETE_STATEMENT = f \"\"\" DELETE FROM { self . _METADATA_TABLE } WHERE name = ?; \"\"\" self . _sql_connector . execute_query ( query = DELETE_STATEMENT , params = ( name ,)) self . _storage . delete ( name = name )","title":"Parameters"},{"location":"reference/#spectatordb.spectatordb.SpectatorDB.insert","text":"Insert a media data.","title":"insert"},{"location":"reference/#spectatordb.spectatordb.SpectatorDB.insert--parameters","text":"file : pathlib.Path The full path of the file to be inserted. media_type : MediaType The type of the data, either VIDEO or IMAGE. Source code in spectatordb/spectatordb.py 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 def insert ( self , file : pathlib . Path , media_type : MediaType ) -> None : \"\"\"Insert a media data. Parameters ---------- file : pathlib.Path The full path of the file to be inserted. media_type : MediaType The type of the data, either VIDEO or IMAGE. \"\"\" INSERT_STATEMENT = f \"\"\" INSERT INTO { self . _METADATA_TABLE } ( name, path, size, media_type, format, inserted_at, ) VALUES (?, ?, ?, ?, ?, ?, ?); \"\"\" self . _storage . save ( file , mode = storage . SaveMode . COPY ) self . _sql_connector . execute_query ( query = INSERT_STATEMENT , params = ( file . name , str ( file ), file . stat () . st_size , media_type . value , file . suffix . lstrip ( \".\" ), datetime . now () . isoformat (), ), )","title":"Parameters"},{"location":"reference/#spectatordb.storage","text":"","title":"storage"},{"location":"reference/#spectatordb.storage.local_storage","text":"","title":"local_storage"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage","text":"Bases: Storage Local file system storage backend. Provides methods to save, retrieve, delete, and list files in a local directory.","title":"LocalStorage"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage--parameters","text":"storage_dir : pathlib.Path The directory where files will be stored. If it does not exist, it will be created.","title":"Parameters"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage--example","text":"storage = LocalStorage(pathlib.Path('/path/to/storage')) storage.save(pathlib.Path('/path/to/file.txt')) storage.retrieve('file.txt', pathlib.Path('/path/to/destination')) storage.delete('file.txt') files = storage.list_all() # List all stored files Source code in spectatordb/storage/local_storage.py 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 class LocalStorage ( storage . Storage ): \"\"\"Local file system storage backend. Provides methods to save, retrieve, delete, and list files in a local directory. Parameters ---------- storage_dir : pathlib.Path The directory where files will be stored. If it does not exist, it will be created. Example ------- >>> storage = LocalStorage(pathlib.Path('/path/to/storage')) >>> storage.save(pathlib.Path('/path/to/file.txt')) >>> storage.retrieve('file.txt', pathlib.Path('/path/to/destination')) >>> storage.delete('file.txt') >>> files = storage.list_all() # List all stored files \"\"\" def __init__ ( self , storage_dir : pathlib . Path ): self . _storage_dir = storage_dir self . _storage_dir . mkdir ( parents = True , exist_ok = True ) @override def save ( self , file : pathlib . Path , mode : Optional [ storage . SaveMode ] = storage . SaveMode . COPY , ) -> None : \"\"\"Save a file to the local storage directory. Parameters ---------- file : pathlib.Path The full path of the file to be saved. mode : SaveMode The mode to save the file, either COPY or MOVE. Raises ------ FileNotFoundError If the source file does not exist. FileExistsError If the file already exists in the storage directory when using COPY mode. \"\"\" if not file . exists (): raise FileNotFoundError ( f \"Source file { file } does not exist.\" ) target_path = self . _storage_dir / file . name if mode == storage . SaveMode . MOVE : shutil . move ( file , target_path ) else : if target_path . exists (): raise FileExistsError ( f \"File { target_path } already exists in storage.\" ) shutil . copy2 ( file , target_path ) @override def retrieve ( self , name : str , dest : pathlib . Path ) -> None : \"\"\"Retrieve a file from the local storage directory to a destination path. Parameters ---------- name : str The name of the file to retrieve. dest : pathlib.Path The destination path where the file will be copied. Raises ------ FileNotFoundError If the file does not exist in the storage directory. \"\"\" target_path = self . _storage_dir / name if not target_path . exists (): raise FileNotFoundError ( f \"Video ' { name } ' not found.\" ) shutil . copy2 ( target_path , dest ) @override def delete ( self , name : str ) -> None : \"\"\"Delete a file from the local storage directory. Parameters ---------- name : str The name of the file to delete. \"\"\" target_path = self . _storage_dir / name if target_path . exists (): target_path . unlink () @override def list_all ( self ) -> list [ pathlib . Path ]: \"\"\"List all files stored in the local storage directory. Returns ------- list[pathlib.Path] A list of pathlib.Path objects representing all files in the storage directory. \"\"\" return list ( self . _storage_dir . iterdir ())","title":"Example"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage.delete","text":"Delete a file from the local storage directory.","title":"delete"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage.delete--parameters","text":"name : str The name of the file to delete. Source code in spectatordb/storage/local_storage.py 88 89 90 91 92 93 94 95 96 97 98 99 @override def delete ( self , name : str ) -> None : \"\"\"Delete a file from the local storage directory. Parameters ---------- name : str The name of the file to delete. \"\"\" target_path = self . _storage_dir / name if target_path . exists (): target_path . unlink ()","title":"Parameters"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage.list_all","text":"List all files stored in the local storage directory.","title":"list_all"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage.list_all--returns","text":"list[pathlib.Path] A list of pathlib.Path objects representing all files in the storage directory. Source code in spectatordb/storage/local_storage.py 101 102 103 104 105 106 107 108 109 110 111 @override def list_all ( self ) -> list [ pathlib . Path ]: \"\"\"List all files stored in the local storage directory. Returns ------- list[pathlib.Path] A list of pathlib.Path objects representing all files in the storage directory. \"\"\" return list ( self . _storage_dir . iterdir ())","title":"Returns"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage.retrieve","text":"Retrieve a file from the local storage directory to a destination path.","title":"retrieve"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage.retrieve--parameters","text":"name : str The name of the file to retrieve. dest : pathlib.Path The destination path where the file will be copied.","title":"Parameters"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage.retrieve--raises","text":"FileNotFoundError If the file does not exist in the storage directory. Source code in spectatordb/storage/local_storage.py 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 @override def retrieve ( self , name : str , dest : pathlib . Path ) -> None : \"\"\"Retrieve a file from the local storage directory to a destination path. Parameters ---------- name : str The name of the file to retrieve. dest : pathlib.Path The destination path where the file will be copied. Raises ------ FileNotFoundError If the file does not exist in the storage directory. \"\"\" target_path = self . _storage_dir / name if not target_path . exists (): raise FileNotFoundError ( f \"Video ' { name } ' not found.\" ) shutil . copy2 ( target_path , dest )","title":"Raises"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage.save","text":"Save a file to the local storage directory.","title":"save"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage.save--parameters","text":"file : pathlib.Path The full path of the file to be saved. mode : SaveMode The mode to save the file, either COPY or MOVE.","title":"Parameters"},{"location":"reference/#spectatordb.storage.local_storage.LocalStorage.save--raises","text":"FileNotFoundError If the source file does not exist. FileExistsError If the file already exists in the storage directory when using COPY mode. Source code in spectatordb/storage/local_storage.py 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 @override def save ( self , file : pathlib . Path , mode : Optional [ storage . SaveMode ] = storage . SaveMode . COPY , ) -> None : \"\"\"Save a file to the local storage directory. Parameters ---------- file : pathlib.Path The full path of the file to be saved. mode : SaveMode The mode to save the file, either COPY or MOVE. Raises ------ FileNotFoundError If the source file does not exist. FileExistsError If the file already exists in the storage directory when using COPY mode. \"\"\" if not file . exists (): raise FileNotFoundError ( f \"Source file { file } does not exist.\" ) target_path = self . _storage_dir / file . name if mode == storage . SaveMode . MOVE : shutil . move ( file , target_path ) else : if target_path . exists (): raise FileExistsError ( f \"File { target_path } already exists in storage.\" ) shutil . copy2 ( file , target_path )","title":"Raises"},{"location":"reference/#spectatordb.storage.storage","text":"","title":"storage"},{"location":"reference/#spectatordb.storage.storage.SaveMode","text":"Bases: StrEnum Defines the modes for saving files in storage. Source code in spectatordb/storage/storage.py 10 11 12 13 14 class SaveMode ( enum . StrEnum ): \"\"\"Defines the modes for saving files in storage.\"\"\" COPY = enum . auto () MOVE = enum . auto ()","title":"SaveMode"},{"location":"reference/#spectatordb.storage.storage.Storage","text":"Abstract base class for storage backends. Defines the interface for saving, retrieving, deleting, and listing data objects. Source code in spectatordb/storage/storage.py 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 class Storage : \"\"\"Abstract base class for storage backends. Defines the interface for saving, retrieving, deleting, and listing data objects. \"\"\" @abc . abstractmethod def save ( self , file : pathlib . Path , mode : Optional [ SaveMode ] = SaveMode . COPY ) -> None : \"\"\"Save a file into the storage system. Parameters ---------- file : pathlib.Path The full path of the file to be saved in storage. mode: SaveMode Copy or move the file to the storage system. \"\"\" pass @abc . abstractmethod def retrieve ( self , name : str , dest : pathlib . Path ): \"\"\"Retrieve the file to the given destination. Parameters ---------- name : str The name or identifier of the file to retrieve. dest: pathlib.Path The destination that the file is retrieved to. \"\"\" pass @abc . abstractmethod def delete ( self , name : str ) -> None : \"\"\"Delete a file by its name. Parameters ---------- name : str The name or identifier of the file to delete. \"\"\" pass @abc . abstractmethod def list_all ( self ) -> list [ pathlib . Path ]: \"\"\"Return a list of names or identifiers for all stored files.\"\"\" pass","title":"Storage"},{"location":"reference/#spectatordb.storage.storage.Storage.delete","text":"Delete a file by its name.","title":"delete"},{"location":"reference/#spectatordb.storage.storage.Storage.delete--parameters","text":"name : str The name or identifier of the file to delete. Source code in spectatordb/storage/storage.py 52 53 54 55 56 57 58 59 60 61 @abc . abstractmethod def delete ( self , name : str ) -> None : \"\"\"Delete a file by its name. Parameters ---------- name : str The name or identifier of the file to delete. \"\"\" pass","title":"Parameters"},{"location":"reference/#spectatordb.storage.storage.Storage.list_all","text":"Return a list of names or identifiers for all stored files. Source code in spectatordb/storage/storage.py 63 64 65 66 @abc . abstractmethod def list_all ( self ) -> list [ pathlib . Path ]: \"\"\"Return a list of names or identifiers for all stored files.\"\"\" pass","title":"list_all"},{"location":"reference/#spectatordb.storage.storage.Storage.retrieve","text":"Retrieve the file to the given destination.","title":"retrieve"},{"location":"reference/#spectatordb.storage.storage.Storage.retrieve--parameters","text":"name : str The name or identifier of the file to retrieve. pathlib.Path The destination that the file is retrieved to. Source code in spectatordb/storage/storage.py 38 39 40 41 42 43 44 45 46 47 48 49 50 @abc . abstractmethod def retrieve ( self , name : str , dest : pathlib . Path ): \"\"\"Retrieve the file to the given destination. Parameters ---------- name : str The name or identifier of the file to retrieve. dest: pathlib.Path The destination that the file is retrieved to. \"\"\" pass","title":"Parameters"},{"location":"reference/#spectatordb.storage.storage.Storage.save","text":"Save a file into the storage system.","title":"save"},{"location":"reference/#spectatordb.storage.storage.Storage.save--parameters","text":"file : pathlib.Path The full path of the file to be saved in storage. mode: SaveMode Copy or move the file to the storage system. Source code in spectatordb/storage/storage.py 23 24 25 26 27 28 29 30 31 32 33 34 35 36 @abc . abstractmethod def save ( self , file : pathlib . Path , mode : Optional [ SaveMode ] = SaveMode . COPY ) -> None : \"\"\"Save a file into the storage system. Parameters ---------- file : pathlib.Path The full path of the file to be saved in storage. mode: SaveMode Copy or move the file to the storage system. \"\"\" pass","title":"Parameters"}]}